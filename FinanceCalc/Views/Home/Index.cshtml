@using Microsoft.AspNetCore.Identity
@model FinanceCalc.Models.DashboardViewModel

<link rel="stylesheet" href="~/css/dashboard.css" />
<link rel="stylesheet" href="~/css/hero-gradient.css" />
<script src="~/js/dashboard.js"></script>

@{
    ViewData["Title"] = "Home";
    var expenses = Model.Expenses;
    var income = Model.Income;
    var savings = Model.Savings;
}

@if (User.Identity.IsAuthenticated)
{
    <link rel="stylesheet" href="~/css/dashboard.css" />
    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div>
                <h1 class="dashboard-title">Financial Overview</h1>
                <p class="dashboard-subtitle">Track your income, expenses, and savings</p>
            </div>
            <div class="header-buttons">
                <button class="btn btn-modern btn-filter">
                    <i class="bi bi-funnel"></i>
                    Filter
                </button>

                <!-- Combined Import/Export Dropdown -->
                <div class="dropdown">
                    <button class="btn btn-modern btn-data dropdown-toggle" type="button" id="dataDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-arrow-down-up"></i>
                        Data
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dataDropdown">
                        <!-- Import Section -->
                        <li class="dropdown-header">
                            <i class="bi bi-upload me-2"></i>Import Data
                        </li>
                        <li>
                            <a class="dropdown-item" href="#" onclick="triggerFileInput('csv')">
                                <i class="fas fa-file-csv text-primary"></i> Import from CSV
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="#" onclick="triggerFileInput('excel')">
                                <i class="fas fa-file-excel text-success"></i> Import from Excel
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="#" onclick="triggerFileInput('pdf')">
                                <i class="fas fa-file-pdf text-danger"></i> Import from PDF
                            </a>
                        </li>

                        <!-- Divider -->
                        <li><hr class="dropdown-divider"></li>

                        <!-- Export Section -->
                        <li class="dropdown-header">
                            <i class="bi bi-download me-2"></i>Export Data
                        </li>
                        <li>
                            <a class="dropdown-item" asp-controller="ImportExport" asp-action="ExportToPdf">
                                <i class="fas fa-file-pdf text-danger"></i> Export to PDF
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" asp-controller="ImportExport" asp-action="ExportToExcel">
                                <i class="fas fa-file-excel text-success"></i> Export to Excel
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" asp-controller="ImportExport" asp-action="ExportToCsv">
                                <i class="fas fa-file-csv text-primary"></i> Export to CSV
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Hidden file input for import -->
        <input type="file" id="importFileInput" style="display: none;" accept=".csv,.xlsx,.xls,.pdf" onchange="handleFileImport(this)">

        <!-- Import Progress Modal -->
        <div class="modal fade" id="importProgressModal" tabindex="-1" aria-labelledby="importProgressModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="importProgressModalLabel">Importing Transactions</h5>
                    </div>
                    <div class="modal-body text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">Processing your file, please wait...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Import Results Modal -->
        <div class="modal fade" id="importResultsModal" tabindex="-1" aria-labelledby="importResultsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="importResultsModalLabel">Import Results</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="importResultsContent">
                        <!-- Results will be populated here -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="location.reload()">OK</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Metric Cards -->
        <div class="metrics-grid">
            <!-- Total Income Card -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon income">
                        <i class="bi bi-trending-up"></i>
                    </div>
                    <button class="add-btn" data-bs-toggle="modal" data-bs-target="#addIncomeModal">
                        <i class="bi bi-plus" style="font-size: 20px;"></i>
                    </button>
                </div>
                <div class="metric-content">
                    <p class="metric-label">Total Income</p>
                    <p class="metric-value">@((ViewBag.MonthlyIncome as decimal?)?.ToString("C") ?? "$0")</p>
                    <p class="metric-change positive">+12.5% vs last month</p>
                </div>
            </div>

            <!-- Total Expenses Card -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon expense">
                        <i class="bi bi-trending-down"></i>
                    </div>
                    <button class="add-btn" data-bs-toggle="modal" data-bs-target="#addExpenseModal">
                        <i class="bi bi-plus" style="font-size: 20px;"></i>
                    </button>
                </div>
                <div class="metric-content">
                    <p class="metric-label">Total Expenses</p>
                    <p class="metric-value">@((ViewBag.IncomeVsExpenseData != null && ViewBag.IncomeVsExpenseData.Length > 0 ? (ViewBag.IncomeVsExpenseData[0] as decimal?)?.ToString("C") : "$0"))</p>
                    <p class="metric-change negative">+8.2% vs last month</p>
                </div>
            </div>

            <!-- Savings Goal Card -->
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-icon savings">
                        <i class="bi bi-bullseye"></i>
                    </div>
                    <button class="add-btn" data-bs-toggle="modal" data-bs-target="#addSavingsModal">
                        <i class="bi bi-plus" style="font-size: 20px;"></i>
                    </button>
                </div>
                <div class="metric-content">
                    <p class="metric-label">Savings Goal</p>
                    <p class="metric-value">@((ViewBag.CurrentSavings as decimal?)?.ToString("C") ?? "$0")</p>
                    <p class="metric-change neutral">68% of goal vs last month</p>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="charts-grid">
            <!-- Expenses by Category -->
            <div class="chart-card">
                <h3 class="chart-title">Expenses by Category</h3>
                <div class="chart-container">
                    <canvas id="expenseChart"></canvas>
                </div>
            </div>

            <!-- Income vs Expenses -->
            <div class="chart-card">
                <h3 class="chart-title">Income vs Expenses</h3>
                <div class="chart-container">
                    <canvas id="incomeChart"></canvas>
                </div>
            </div>

            <!-- Savings Progress -->
            <div class="chart-card">
                <h3 class="chart-title">Savings Progress</h3>
                <div class="chart-container">
                    <canvas id="savingsChart"></canvas>
                </div>
                <div class="chart-footer">
                    @((ViewBag.CurrentSavings as decimal?)?.ToString("C") ?? "$0") of @((ViewBag.SavingsGoal as decimal?)?.ToString("C") ?? "$0")
                </div>
            </div>
        </div>

        <!-- Recent Transactions -->
        <div class="transactions-section">
            <h3 class="transactions-title">Recent Transactions</h3>
            @foreach (var item in Model.Expenses.Take(5))
            {
                var bgColor = item.Category switch
                {
                    "Food" => "#fff4e0",
                    "Transportation" => "#e8f0ff",
                    "Utilities" => "#fff1e6",
                    "Entertainment" => "#f4e8ff",
                    "Health & Medical" => "#e0f7f1",
                    "Housing" => "#ffe4e1",
                    "Education" => "#e6f7ff",
                    "Personal Care" => "#fdf0ff",
                    "Clothing" => "#fffbe6",
                    "Travel" => "#e8faff",
                    "Gifts & Donations" => "#f5e6ff",
                    "Insurance" => "#e6f0ff",
                    "Subscriptions" => "#f4f4f4",
                    "Phone & Internet" => "#edf7ff",
                    "Home Maintenance" => "#fff8e1",
                    "Childcare" => "#ffe6f0",
                    "Pet Care" => "#e6fce9",
                    "Taxes" => "#fef1e6",
                    "Bank Fees" => "#f8e6ff",
                    "Loan Payments" => "#e6f5ff",
                    "Fuel" => "#fff0e6",
                    "Parking & Tolls" => "#e6f4ff",
                    "Office Supplies" => "#f0f4ff",
                    "Dining Out" => "#ffe6d9",
                    "Gym & Fitness" => "#e0fff4",
                    "Beauty & Grooming" => "#ffe6fa",
                    "Hobbies" => "#f0eaff",
                    "Miscellaneous" => "#f5f5f5",
                    "Salary" => "#e0ffe0",
                    _ => "#f0f0f0"
                };

                var emoji = item.Category switch
                {
                    "Food" => "🍔",
                    "Transportation" => "🚗",
                    "Utilities" => "💡",
                    "Entertainment" => "🎮",
                    "Health & Medical" => "🩺",
                    "Housing" => "🏠",
                    "Education" => "🎓",
                    "Personal Care" => "🧴",
                    "Clothing" => "👕",
                    "Travel" => "✈️",
                    "Gifts & Donations" => "🎁",
                    "Insurance" => "🛡️",
                    "Subscriptions" => "📺",
                    "Phone & Internet" => "📱",
                    "Home Maintenance" => "🔧",
                    "Childcare" => "🧒",
                    "Pet Care" => "🐾",
                    "Taxes" => "💰",
                    "Bank Fees" => "🏦",
                    "Loan Payments" => "💳",
                    "Fuel" => "⛽",
                    "Parking & Tolls" => "🅿️",
                    "Office Supplies" => "📎",
                    "Dining Out" => "🍽️",
                    "Gym & Fitness" => "🏋️",
                    "Beauty & Grooming" => "💄",
                    "Hobbies" => "🎨",
                    "Miscellaneous" => "🧩",
                    "Salary" => "💼",
                    _ => "💸"
                };

               
                string amountColorClass = "text-danger";

                <div class="transaction-item">
                    <div class="transaction-left">
                        <div class="transaction-icon" style="background-color: @bgColor;">
                            <span>@emoji</span>
                        </div>
                        <div class="transaction-info">
                            <h6>@item.Category</h6>
                            <p>@item.Date.ToString("MMM dd, yyyy")</p>
                        </div>
                    </div>
                    <div class="transaction-right">
                        <p class="transaction-amount @amountColorClass">@item.Amount.ToString("C")</p>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Add Expense Modal -->
    <div class="modal fade" id="addExpenseModal" tabindex="-1" aria-labelledby="addExpenseModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <form id="addExpenseForm" onsubmit="submitExpense(event)">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addExpenseModalLabel">Add Expense</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="expenseAmount" class="form-label">Amount</label>
                            <input type="number" step="0.01" class="form-control" id="expenseAmount" required>
                        </div>
                        <div class="mb-3">
                            <label for="expenseCategory" class="form-label">Category</label>
                            <select class="form-select" id="expenseCategory" required>
                                <option value="" disabled selected>Select category</option>
                                <option>Food</option>
                                <option>Transportation</option>
                                <option>Utilities</option>
                                <option>Entertainment</option>
                                <option>Health & Medical</option>
                                <option>Housing</option>
                                <option>Education</option>
                                <option>Personal Care</option>
                                <option>Clothing</option>
                                <option>Travel</option>
                                <option>Gifts & Donations</option>
                                <option>Insurance</option>
                                <option>Subscriptions</option>
                                <option>Phone & Internet</option>
                                <option>Home Maintenance</option>
                                <option>Childcare</option>
                                <option>Pet Care</option>
                                <option>Taxes</option>
                                <option>Bank Fees</option>
                                <option>Loan Payments</option>
                                <option>Fuel</option>
                                <option>Parking & Tolls</option>
                                <option>Office Supplies</option>
                                <option>Dining Out</option>
                                <option>Gym & Fitness</option>
                                <option>Beauty & Grooming</option>
                                <option>Hobbies</option>
                                <option>Miscellaneous</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="expenseDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="expenseDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="expenseNote" class="form-label">Note (optional)</label>
                            <textarea class="form-control" id="expenseNote" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Add Expense</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Income Modal -->
    <div class="modal fade" id="addIncomeModal" tabindex="-1" aria-labelledby="addIncomeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <form id="addIncomeForm" onsubmit="submitIncome(event)">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addIncomeModalLabel">Add Income</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="incomeAmount" class="form-label">Amount</label>
                            <input type="number" step="0.01" class="form-control" id="incomeAmount" required>
                            <div id="incomeAmountError" class="text-danger mt-1" style="display:none;"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Add Income</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Savings Modal -->
    <div class="modal fade" id="addSavingsModal" tabindex="-1" aria-labelledby="addSavingsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <form id="addSavingsForm" onsubmit="submitSavings(event)">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addSavingsModalLabel">Add Savings</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="targetAmount" class="form-label">Target Amount <span class="text-danger">*</span></label>
                            <input type="number" step="0.01" class="form-control" id="targetAmount" required placeholder="Enter target savings amount">
                            <div id="targetAmountError" class="text-danger mt-1" style="display:none;"></div>
                        </div>
                        <div class="mb-3">
                            <label for="currentAmount" class="form-label">Current Amount</label>
                            <input type="number" step="0.01" class="form-control" id="currentAmount" placeholder="Enter current savings amount (optional)">
                            <div id="currentAmountError" class="text-danger mt-1" style="display:none;"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Save Savings</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
}
else
{
    <link rel="stylesheet" href="~/css/landing.css" />
    <div class="landing-container">
        <!-- Hero with Dashboard Preview -->
        <section class="hero-with-dashboard hero-gradient-bg-mesh">
            <div class="hero-content">
                <div class="hero-badge">
                    <i class="bi bi-shield-check"></i>
                    Trusted by 50,000+ users worldwide
                </div>
                <h1>Take Control of Your <span class="highlight">Financial Future</span></h1>
                <p>Stop wondering where your money goes. Track expenses, set budgets, and build wealth with our intuitive financial management platform.</p>
                <div class="hero-buttons">
                    <a href="/Identity/Account/Register" class="cta-button">
                        Start Free Today <i class="bi bi-arrow-right"></i>
                    </a>
                    <a href="#demo" class="btn-secondary-cta">Watch Demo</a>
                </div>
                <div class="hero-stats">
                    <div class="hero-stat">
                        <h3>50K+</h3>
                        <p>Active Users</p>
                    </div>
                    <div class="hero-stat">
                        <h3>$2M+</h3>
                        <p>Money Tracked</p>
                    </div>
                    <div class="hero-stat">
                        <h3>99.9%</h3>
                        <p>Uptime</p>
                    </div>
                </div>
            </div>
            <div class="dashboard-preview">
                <div class="savings-badge">+$125 saved</div>
                <div class="dashboard-mockup">
                    <div class="mockup-header">
                        <h3 class="mockup-title">Financial Overview</h3>
                        <div class="mockup-dots">
                            <div class="dot red"></div>
                            <div class="dot yellow"></div>
                            <div class="dot green"></div>
                        </div>
                    </div>
                    <div class="mockup-metrics">
                        <div class="mockup-metric">
                            <div class="metric-icon-small green">
                                <i class="bi bi-trending-up"></i>
                            </div>
                            <h4>$4,250</h4>
                            <p>Total Income</p>
                            <span class="change positive">+12%</span>
                        </div>
                        <div class="mockup-metric">
                            <div class="metric-icon-small blue">
                                <i class="bi bi-credit-card"></i>
                            </div>
                            <h4>$2,890</h4>
                            <p>Expenses</p>
                            <span class="change negative">-8%</span>
                        </div>
                    </div>
                    <div class="savings-progress">
                        <div class="progress-title">Savings Goal</div>
                        <div class="progress-bar">
                            <div class="progress-fill"></div>
                        </div>
                        <div class="progress-text">$1,360 of $2,000 saved</div>
                        <div style="margin-top: 8px;">
                            <span style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 12px; font-size: 10px;">Budget on track</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="hero-section">
            <h1 class="hero-title">Everything you need to <span class="highlight">master your money</span></h1>
            <p class="hero-subtitle">Our comprehensive suite of tools makes financial management simple, intuitive, and effective for everyone.</p>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon blue">
                        <i class="bi bi-clock"></i>
                    </div>
                    <h3 class="feature-title">Smart Expense Tracking</h3>
                    <p class="feature-description">Automatically categorize and track your expenses with intelligent insights that help you understand your spending patterns.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon purple">
                        <i class="bi bi-bullseye"></i>
                    </div>
                    <h3 class="feature-title">Goal-Based Budgeting</h3>
                    <p class="feature-description">Set and achieve your financial goals with personalized budgets that adapt to your lifestyle and priorities.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon green">
                        <i class="bi bi-graph-up"></i>
                    </div>
                    <h3 class="feature-title">Real-Time Analytics</h3>
                    <p class="feature-description">Get instant insights into your financial health with beautiful charts and reports that make data easy to understand.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon orange">
                        <i class="bi bi-phone"></i>
                    </div>
                    <h3 class="feature-title">Mobile-First Design</h3>
                    <p class="feature-description">Manage your money on the go with our responsive design that works perfectly on any device, anywhere.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon purple">
                        <i class="bi bi-shield-check"></i>
                    </div>
                    <h3 class="feature-title">Bank-Level Security</h3>
                    <p class="feature-description">Your financial data is protected with enterprise-grade encryption and security measures you can trust.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon teal">
                        <i class="bi bi-credit-card"></i>
                    </div>
                    <h3 class="feature-title">Multi-Account Support</h3>
                    <p class="feature-description">Connect all your accounts in one place - bank accounts, credit cards, investments, and crypto wallets.</p>
                </div>
            </div>
        </section>

        <!-- Articles Section -->
        <section class="articles-section">
            <h2 class="section-title">Learn from our <span class="highlight">financial experts</span></h2>
            <p class="section-subtitle">Discover smart money habits, practical tips, and strategies to make your finances work for you.</p>
            <div class="articles-grid">
                <article class="article-card">
                    <div class="article-image">
                        <span class="article-tag">Saving Tips</span>
                    </div>
                    <div class="article-content">
                        <div class="article-meta">5 min read</div>
                        <h3 class="article-title">5 Easy Ways to Start Saving Today</h3>
                        <p class="article-excerpt">Simple strategies to help you save money fast — even on a tight budget.</p>
                        <a href="#" class="read-more">Read More <i class="bi bi-arrow-right"></i></a>
                    </div>
                </article>
                <article class="article-card">
                    <div class="article-image">
                        <span class="article-tag">Emergency Planning</span>
                    </div>
                    <div class="article-content">
                        <div class="article-meta">7 min read</div>
                        <h3 class="article-title">How to Build an Emergency Fund That Works</h3>
                        <p class="article-excerpt">Learn how to protect yourself from financial surprises with a strong emergency fund.</p>
                        <a href="#" class="read-more">Read More <i class="bi bi-arrow-right"></i></a>
                    </div>
                </article>
                <article class="article-card">
                    <div class="article-image">
                        <span class="article-tag">Financial Planning</span>
                    </div>
                    <div class="article-content">
                        <div class="article-meta">10 min read</div>
                        <h3 class="article-title">Master Your Money: A Beginner's Guide</h3>
                        <p class="article-excerpt">A beginner's guide to budgeting, saving, and taking control of your finances.</p>
                        <a href="#" class="read-more">Read More <i class="bi bi-arrow-right"></i></a>
                    </div>
                </article>
            </div>
            <a href="#" class="cta-button">View All Articles <i class="bi bi-arrow-right"></i></a>
        </section>

        <!-- Transform Section -->
        <section class="transform-section">
            <div class="transform-content">
                <h2>Transform your <span class="highlight">financial life</span></h2>
                <p class="transform-description">Join thousands of people who've taken control of their finances and built the life they want. It's time to stop worrying about money and start making it work for you.</p>
                <ul class="benefits-list">
                    <li>
                        <span class="check-icon">✓</span>
                        Stop living paycheck to paycheck
                    </li>
                    <li>
                        <span class="check-icon">✓</span>
                        Build an emergency fund that protects you
                    </li>
                    <li>
                        <span class="check-icon">✓</span>
                        Save for your dreams - vacation, home, education
                    </li>
                    <li>
                        <span class="check-icon">✓</span>
                        Reduce financial stress and anxiety
                    </li>
                    <li>
                        <span class="check-icon">✓</span>
                        Make informed spending decisions
                    </li>
                    <li>
                        <span class="check-icon">✓</span>
                        Track progress toward your goals
                    </li>
                </ul>
                <a href="/Identity/Account/Register" class="cta-button">
                    Start Your Journey <i class="bi bi-arrow-right"></i>
                </a>
            </div>
            <div class="stats-panel">
                <h3 class="stats-title">Real Results from Real Users</h3>
                <div class="stat-item">
                    <div class="stat-left">
                        <div class="stat-value green">87%</div>
                        <div class="stat-label">Reduced financial stress</div>
                    </div>
                    <div class="stat-icon-badge green">
                        <i class="bi bi-bar-chart"></i>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-left">
                        <div class="stat-value blue">$1,247</div>
                        <div class="stat-label">Average monthly savings increase</div>
                    </div>
                    <div class="stat-icon-badge yellow">
                        💰
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-left">
                        <div class="stat-value purple">3.2x</div>
                        <div class="stat-label">Faster goal achievement</div>
                    </div>
                    <div class="stat-icon-badge red">
                        <i class="bi bi-bullseye"></i>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-left">
                        <div class="stat-value orange">92%</div>
                        <div class="stat-label">Would recommend to friends</div>
                    </div>
                    <div class="stat-icon-badge orange">
                        <i class="bi bi-star-fill"></i>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section class="testimonials-section">
            <h2 class="section-title">Loved by thousands of <span class="highlight">happy users</span></h2>
            <p class="section-subtitle">Don't just take our word for it. Here's what real people are saying about their financial transformation.</p>
            <div class="testimonials-grid">
                <div class="testimonial-card">
                    <div class="stars">★★★★★</div>
                    <p class="testimonial-text">"This app completely changed how I think about money. I've saved more in 6 months than I did in 2 years before. The budgeting tools are incredibly intuitive!"</p>
                    <div class="testimonial-author">
                        <div class="author-avatar">SJ</div>
                        <div class="author-info">
                            <h4>Sarah Johnson</h4>
                            <p>Marketing Manager</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="stars">★★★★★</div>
                    <p class="testimonial-text">"As someone who loves data, the analytics and insights are phenomenal. I can see exactly where my money goes and make informed decisions about my spending."</p>
                    <div class="testimonial-author">
                        <div class="author-avatar">MC</div>
                        <div class="author-info">
                            <h4>Michael Chen</h4>
                            <p>Software Engineer</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="stars">★★★★★</div>
                    <p class="testimonial-text">"Managing both personal and business finances used to be a nightmare. Now everything is organized and I have complete visibility into my financial health."</p>
                    <div class="testimonial-author">
                        <div class="author-avatar">ER</div>
                        <div class="author-info">
                            <h4>Emily Rodriguez</h4>
                            <p>Small Business Owner</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Final CTA -->
    <section class="final-cta">
        <div class="landing-container">
            <div class="rating-badge">
                ⭐ 4.9/5 from over 2,000 reviews
            </div>
            <h2>Ready to take control of your financial future?</h2>
            <p>Join thousands of people who've transformed their financial lives. Start your journey to financial freedom today - it's completely free!</p>
            <div class="cta-buttons">
                <a href="/Identity/Account/Register" class="btn-primary-cta">
                    Get Started Free <i class="bi bi-arrow-right"></i>
                </a>
                <a href="#demo" class="btn-secondary-cta">Watch Demo</a>
            </div>
            <div class="trust-indicators">
                <div class="trust-item">
                    <i class="bi bi-shield-check"></i>
                    Bank-level security
                </div>
                <div class="trust-item">
                    <i class="bi bi-credit-card"></i>
                    No credit card required
                </div>
                <div class="trust-item">
                    <i class="bi bi-phone"></i>
                    Works on all devices
                </div>
            </div>
        </div>
    </section>
}

@section Scripts {
    @if (User.Identity.IsAuthenticated)
    {
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            let expenseChart, incomeChart, savingsChart;

            // IMPORT FUNCTIONS
            function triggerFileInput(type) {
                const fileInput = document.getElementById('importFileInput');

                // Set accept attribute based on type
                switch (type) {
                    case 'csv':
                        fileInput.accept = '.csv';
                        break;
                    case 'excel':
                        fileInput.accept = '.xlsx,.xls';
                        break;
                    case 'pdf':
                        fileInput.accept = '.pdf';
                        break;
                    default:
                        fileInput.accept = '.csv,.xlsx,.xls,.pdf';
                }

                fileInput.click();
            }

            async function handleFileImport(input) {
                const file = input.files[0];
                if (!file) return;

                // Show progress modal
                const progressModal = new bootstrap.Modal(document.getElementById('importProgressModal'));
                progressModal.show();

                const formData = new FormData();
                formData.append('file', file);

                try {
                    const response = await fetch('/ImportExport/ImportFile', {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();

                    // Hide progress modal
                    progressModal.hide();

                    // Show results modal
                    showImportResults(result);

                } catch (error) {
                    progressModal.hide();
                    showImportResults({
                        success: false,
                        message: 'Error uploading file: ' + error.message
                    });
                }

                // Clear the input
                input.value = '';
            }

            function showImportResults(result) {
                const resultsModal = new bootstrap.Modal(document.getElementById('importResultsModal'));
                const contentDiv = document.getElementById('importResultsContent');

                let content = '';

                if (result.success) {
                    content = `
                                    <div class="alert alert-success">
                                        <i class="fas fa-check-circle me-2"></i>
                                        <strong>Import Successful!</strong>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <h5 class="text-success">${result.imported || 0}</h5>
                                                    <small>Transactions Imported</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card bg-light">
                                                <div class="card-body text-center">
                                                    <h5 class="text-warning">${result.duplicates || 0}</h5>
                                                    <small>Duplicates Skipped</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                } else {
                    content = `
                                    <div class="alert alert-danger">
                                        <i class="fas fa-exclamation-circle me-2"></i>
                                        <strong>Import Failed</strong>
                                    </div>
                                    <p>${result.message}</p>
                                `;
                }

                if (result.errors && result.errors.length > 0) {
                    content += `
                                    <div class="alert alert-warning mt-3">
                                        <h6><i class="fas fa-exclamation-triangle me-2"></i>Warnings:</h6>
                                        <ul class="mb-0">
                                            ${result.errors.map(error => `<li>${error}</li>`).join('')}
                                        </ul>
                                    </div>
                                `;
                }

                contentDiv.innerHTML = content;
                resultsModal.show();
            }

            // Submit Income Function
            async function submitIncome(event) {
                event.preventDefault();
                const amountInput = document.getElementById('incomeAmount');
                const errorDiv = document.getElementById('incomeAmountError');

                if (!amountInput || !errorDiv) {
                    alert('Required elements not found');
                    return;
                }

                const amountValue = amountInput.value.trim();
                // Clear previous error
                errorDiv.style.display = 'none';
                errorDiv.textContent = '';

                if (!amountValue) {
                    errorDiv.textContent = 'Amount is required.';
                    errorDiv.style.display = 'block';
                    amountInput.focus();
                    return;
                }

                const amount = parseFloat(amountValue);
                if (isNaN(amount) || amount <= 0) {
                    errorDiv.textContent = 'Please enter a valid positive amount.';
                    errorDiv.style.display = 'block';
                    amountInput.focus();
                    return;
                }

                const data = { Amount: amount };

                try {
                    const response = await fetch('/Incomes/AddIncome', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data),
                    });

                    if (!response.ok) {
                        let errorMsg = 'Unknown error';
                        try {
                            const errorData = await response.json();
                            errorMsg = errorData.details || errorData.error || errorMsg;
                        } catch {
                            // fallback if JSON parsing fails
                        }
                        alert('Error saving income:\n\n' + errorMsg);
                        return;
                    }

                    const result = await response.json();
                    if (result.success) {
                        const modalElement = document.getElementById('addIncomeModal');
                        const modal = bootstrap.Modal.getInstance(modalElement);
                        modal.hide();
                        document.getElementById('addIncomeForm').reset();
                        location.reload(); // Refresh to show updated data
                    } else {
                        alert('Failed to save income.');
                    }
                } catch (error) {
                    alert('Unexpected error: ' + error.message);
                }
            }

            // Submit Savings Function
            async function submitSavings(event) {
                event.preventDefault();
                const targetInput = document.getElementById('targetAmount');
                const currentInput = document.getElementById('currentAmount');
                const targetErrorDiv = document.getElementById('targetAmountError');
                const currentErrorDiv = document.getElementById('currentAmountError');

                // Clear previous errors
                targetErrorDiv.style.display = 'none';
                targetErrorDiv.textContent = '';
                currentErrorDiv.style.display = 'none';
                currentErrorDiv.textContent = '';

                if (!targetInput || !targetErrorDiv || !currentErrorDiv) {
                    alert('Required elements not found');
                    return;
                }

                const targetValue = targetInput.value.trim();
                const currentValue = currentInput.value.trim();

                if (!targetValue) {
                    targetErrorDiv.textContent = 'Target amount is required.';
                    targetErrorDiv.style.display = 'block';
                    targetInput.focus();
                    return;
                }

                const targetAmount = parseFloat(targetValue);
                if (isNaN(targetAmount) || targetAmount <= 0) {
                    targetErrorDiv.textContent = 'Please enter a valid positive target amount.';
                    targetErrorDiv.style.display = 'block';
                    targetInput.focus();
                    return;
                }

                let currentAmount = 0;
                if (currentValue) {
                    currentAmount = parseFloat(currentValue);
                    if (isNaN(currentAmount) || currentAmount < 0) {
                        currentErrorDiv.textContent = 'Please enter a valid current amount or leave empty.';
                        currentErrorDiv.style.display = 'block';
                        currentInput.focus();
                        return;
                    }
                }

                const data = {
                    TargetAmount: targetAmount,
                    CurrentAmount: currentAmount
                };

                try {
                    const response = await fetch('/Savings/SaveOrUpdateSavings', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data),
                    });

                    if (!response.ok) {
                        let errorMsg = 'Unknown error';
                        try {
                            const errorData = await response.json();
                            errorMsg = errorData.details || errorData.error || errorMsg;
                        } catch {
                            // fallback if JSON parsing fails
                        }
                        alert('Error saving savings:\n\n' + errorMsg);
                        return;
                    }

                    const result = await response.json();
                    if (result.success) {
                        const modalElement = document.getElementById('addSavingsModal');
                        const modal = bootstrap.Modal.getInstance(modalElement);
                        modal.hide();
                        document.getElementById('addSavingsForm').reset();
                        location.reload(); // Refresh to show updated data
                    } else {
                        alert('Failed to save savings.');
                    }
                } catch (error) {
                    alert('Unexpected error: ' + error.message);
                }
            }

            // Submit Expense Function
            async function submitExpense(event) {
                event.preventDefault();
                const amount = parseFloat(document.getElementById('expenseAmount').value);
                const category = document.getElementById('expenseCategory').value;
                const date = document.getElementById('expenseDate').value;
                const description = document.getElementById('expenseNote').value;

                if (!amount || !category || !date) {
                    alert('Please fill all required fields.');
                    return;
                }

                const data = {
                    Amount: amount,
                    Category: category,
                    Date: date,
                    Description: description
                };

                try {
                    const response = await fetch('/Expenses/AddExpense', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });

                    if (!response.ok) {
                        const error = await response.json();
                        const errorText = error.details
                            ? JSON.stringify(error.details)
                            : (error.error || 'Unknown error');
                        alert('Error saving expense:\n\n' + errorText);
                        return;
                    }

                    const result = await response.json();
                    if (result.success) {
                        const modal = bootstrap.Modal.getInstance(document.getElementById('addExpenseModal'));
                        modal.hide();
                        document.getElementById('addExpenseForm').reset();
                        location.reload(); // Refresh to show updated data
                    } else {
                        alert('Failed to save expense.');
                    }
                } catch (error) {
                    alert('Unexpected error: ' + error.message);
                }
            }

            // Initialize Charts
            document.addEventListener("DOMContentLoaded", function () {
                // Expense Chart
                const expenseCtx = document.getElementById('expenseChart').getContext('2d');
                expenseChart = new Chart(expenseCtx, {
                    type: 'doughnut',
                    data: {
                        labels: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.Labels ?? new string[0])),
                        datasets: [{
                            data: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.Data ?? new decimal[0])),
                            backgroundColor: ['#ef4444', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316'],
                            borderWidth: 0,
                            hoverOffset: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '60%',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true,
                                    font: { size: 12 }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: 'white',
                                bodyColor: 'white',
                                cornerRadius: 8
                            }
                        }
                    }
                });

                // Income vs Expenses Chart
                const incomeCtx = document.getElementById('incomeChart').getContext('2d');
                incomeChart = new Chart(incomeCtx, {
                    type: 'bar',
                    data: {
                        labels: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.IncomeVsExpenseLabels ?? new string[] { "Income", "Expenses" })),
                        datasets: [{
                            data: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.IncomeVsExpenseData ?? new decimal[] { 0, 0 })),
                            backgroundColor: ['#ef4444', '#10b981'],
                            borderRadius: 8,
                            borderSkipped: false,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                cornerRadius: 8
                            }
                        },
                        scales: {
                            x: {
                                grid: { display: false },
                                ticks: { font: { size: 12 } }
                            },
                            y: {
                                grid: { color: '#f3f4f6' },
                                ticks: { display: false }
                            }
                        }
                    }
                });

                // Savings Progress Chart
                const currentAmount = @(ViewBag.CurrentSavings ?? 0M);
                const targetAmount = @(ViewBag.SavingsGoal ?? 0M);
                const remainingAmount = Math.max(targetAmount - currentAmount, 0);

                const savingsCtx = document.getElementById('savingsChart').getContext('2d');
                savingsChart = new Chart(savingsCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Current Savings', 'Remaining to Goal'],
                        datasets: [{
                            data: [currentAmount, remainingAmount],
                            backgroundColor: ['#3b82f6', '#e5e7eb'],
                            borderWidth: 0,
                            cutout: '75%'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                cornerRadius: 8
                            }
                        }
                    },
                    plugins: [{
                        beforeDraw: function (chart) {
                            const width = chart.width,
                                height = chart.height,
                                ctx = chart.ctx;
                            ctx.restore();
                            const fontSize = (height / 114).toFixed(2);
                            ctx.font = "bold " + fontSize + "em sans-serif";
                            ctx.textBaseline = "middle";
                            ctx.fillStyle = "#111827";
                            const percentage = targetAmount > 0 ? Math.round((currentAmount / targetAmount) * 100) : 0;
                            const text = percentage + "%";
                            const textX = Math.round((width - ctx.measureText(text).width) / 2);
                            const textY = height / 2;
                            ctx.fillText(text, textX, textY);
                            ctx.save();
                        }
                    }]
                });
            });
        </script>
    }
}
